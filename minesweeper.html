<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="mycss.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <title>MINESWEEPER</title>
    <script>
        //ë©”ì¸ë‹¨ì—ì„œ ì •ë³´ ë°›ì•„ì„œ ê°€ì§€ê³  ìˆëŠ” ë¡œì§ í•„ìš”(todo)
        // const url = location.href;
        // const temp = (url.split('?'))[1].split('');
        // const tempstring = (url.split('?'))[1];
        // const levelInfo=[];
        // console.log(temp);
        // console.log(tempstring);


        let land = [
            [0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 0, 0, 0, 0, 0, 0, 0]
        ];
        let html = "<table id='land'>";

        //ì§€ë¢° ê°¯ìˆ˜ë¥¼ ì¹´ìš´íŒ…í•˜ì—¬ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜
        function countingMine() {
            let mine = 0;
            for (let row of land) {
                for (let column of row) {
                    if (column == 'x') {
                        mine += 1;
                    }
                }
            }
            return mine;
        }

        //ëª¨ì„œë¦¬ ê°ì•ˆí•´ì„œ íƒìƒ‰ ì˜ì—­ ì°¾ì•„ì£¼ëŠ” í•¨ìˆ˜
        function rangeSearching(x, y){
            let arrange;
            if (x == 0 && y == 0) {//ì¢Œì¸¡ ë§¨ìœ„ ëª¨ì„œë¦¬
                arrange = [land[x][y + 1], land[x + 1][y], land[x + 1][y + 1]];
            } else if (x == 0 && y != 0 && y != 8) {//ë§¨ìœ„ ë²½ë©´
                arrange = [land[x][y - 1], land[x + 1][y - 1], land[x + 1][y], land[x + 1][y + 1], land[x][y + 1]];
            } else if (x == 0 && y == 8) {//ìš°ì¸¡ ë§¨ìœ„ ëª¨ì„œë¦¬
                arrange = [land[x][y - 1], land[x + 1][y - 1], land[x + 1][y]];
            } else if (x != 0 && x != 8 && y == 0) {//ìš°ì¸¡ ë²½ë©´
                arrange = [land[x - 1][y], land[x - 1][y + 1], land[x][y + 1], land[x + 1][y + 1], land[x + 1][y]];
            } else if (x != 0 && x != 8 && y == 8) {//ë§¨ì•„ë˜ ë²½ë©´
                arrange = [land[x - 1][y], land[x - 1][y - 1], land[x][y - 1], land[x + 1][y - 1], land[x + 1][y]];
            } else if (x == 8 && y == 0) {//ì¢Œì¸¡ ë§¨ì•„ë˜ ëª¨ì„œë¦¬
                arrange = [land[x - 1][y], land[x - 1][y + 1], land[x][y + 1]];
            } else if (x == 8 && y != 8 && y != 0) {//ì¢Œì¸¡ ë²½ë©´
                arrange = [land[x][y - 1], land[x - 1][y - 1], land[x - 1][y], land[x - 1][y + 1], land[x][y + 1]];
            } else if (x == 8 && y == 8) {//ìš°ì¸¡ ë§¨ì•„ë˜ ëª¨ì„œë¦¬
                arrange = [land[x][y - 1], land[x - 1][y - 1], land[x - 1][y]];
            } else { //ì£¼ìœ„ 8ì¹¸ ì „ë¶€ íƒìƒ‰
                arrange = [
                    land[x - 1][y - 1], land[x - 1][y], land[x - 1][y + 1],
                    land[x][y - 1], land[x][y], land[x][y + 1],
                    land[x + 1][y - 1], land[x + 1][y], land[x + 1][y + 1]
                ]
            }
            return arrange;
        }


        //ì„ íƒí•œ ì¢Œí‘œì˜ ì¸ê·¼ ì§€ë¢°ê°€ ëª‡ê°œ ìˆëŠ”ì§€ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜
        function countingNearMine(x, y) {
            let nearMine = 0;

            let arrange = rangeSearching(x,y);

            for (let i of arrange) {
                if (i == 'x') {
                    nearMine++;
                }
            }

            return nearMine;
        }

        //ì§€ë¢°ë¿Œë¦¬ê¸°
        while (countingMine() < 10) {
            land[Math.floor(Math.random() * 9)][Math.floor(Math.random() * 9)] = 'x';
        }

        //í•„ë“œì— ì¸ì ‘ ì§€ë¢° ê°¯ìˆ˜ ì¹´ìš´íŒ…í•˜ê¸°
        for (let row = 0; row < land.length; row++) {
            for (let column = 0; column < land[row].length; column++) {
                if (land[row][column] != 'x') {
                    land[row][column] = countingNearMine(row, column);
                }
            }
        }

        //htmlì— ì™„ì„±ëœ í•„ë“œ ë¿Œë¦¬ê¸°
        for (let row = 0; row < land.length; row++) {
            html += '<tr>';
            for (let column = 0; column < land[row].length; column++) {
                html += '<td class="hidden">' + land[row][column] + '</td>';
            }
            html += '</tr>';
        }
        html += '</table>';

        console.log(land);

    </script>
</head>

<body>
    <div class="circle"></div>
    <div class="tail" style="position:absolute; left:0; top:0; z-index:999;"></div>
    <header>
        <h2>ğŸ§¡Shall we begin?ğŸ§¡</h2>
    </header>


    <div id='body'>
        <ul id='game-inner-ul'>
            <li id='indicator-li'>
                <span class="indicator">TIME</span>
                <input type="text" value="00:00" class="form-control-style2">
                <span class="indicator">FLAG</span>
                <input type="text" value="999" class="form-control-style2">
            </li>
            <li id='game'></li>
        </ul>
    </div>

</body>
<script>
    //ê²Œì„ í•„ë“œ ë¿Œë¦¼
    document.querySelector('#game').innerHTML = html;

    //í•„ë“œ ì„ íƒí–ˆì„ ê²½ìš° ë™ì‘
    $('#land td').bind('click', function() { 

        let row = $(this).closest('tr').index(); 
        let column = $(this).closest('td').index(); 

        $('#land tr:eq('+row+')>td:eq('+column+')').removeClass('hidden');
        
        if(land[row][column]==0){

        }else if(land[row][column]=='x'){
            $('header >h2').html('ğŸ¤¯TouchÃ©!ğŸ¤¯');
            $('#land tr:eq('+row+')>td:eq('+column+')').addClass('red');
            for(let r=0;r<land.length;r++){
                for(let c=0;c<land[row].length;c++){
                    if(land[r][c]=='x'){
                        $('#land tr:eq('+r+')>td:eq('+c+')').removeClass('hidden');
                    }
                }
            }
            $('#land').addClass('defeat');
        }

    });

    

</script>
<script type="text/javascript" src="mouse.js"></script>
</html>